$(document).ready(function () {

    var t = $('#test').DataTable({
         dom: 'lBfrtip',
        buttons: [
            {
                extend: 'excelHtml5',
                text: '<i class="fa fa-file-excel-o"></i> Excel',
                exportOptions: {
                    columns: [ 1, 2]
                },
                title: ' ',
                filename: 'Riwayat_Terapi_Pasien_' + $('#noRMIsi').val(),
                customize: function (xlsx) {
                    var sheet = xlsx.xl.worksheets['sheet1.xml'];
                    var numrows = 7;
                    var clR = $('row', sheet);

                    //update Row
                    clR.each(function () {
                        var attr = $(this).attr('r');
                        var ind = parseInt(attr);
                        ind = ind + numrows;
                        $(this).attr("r", ind);
                    });

                    // Create row before data
                    $('row c ', sheet).each(function () {
                        var attr = $(this).attr('r');
                        var pre = attr.substring(0, 1);
                        var ind = parseInt(attr.substring(1, attr.length));
                        ind = ind + numrows;
                        $(this).attr("r", pre + ind);
                    });

                    function Addrow(index, data) {
                        msg = '<row r="' + index + '">';
                        for (i = 0; i < data.length; i++) {
                            var key = data[i].key;
                            var value = data[i].value;
                            msg += '<c t="inlineStr" r="' + key + index + '">';
                            msg += '<is>';
                            msg += '<t>' + value + '</t>';
                            msg += '</is>';
                            msg += '</c>';
                        }
                        msg += '</row>';
                        return msg;
                    }


                    //insert
                    var r1 = Addrow(1, [{key: 'A', value: 'Riwayat Terapi Pasien'}, {key: 'B', value: ''}]);
                    var r2 = Addrow(2, [{key: 'A', value: $('#noRMLabel').text()}, {key: 'B', value: $('#noRMIsi').val()}]);
                    var r3 = Addrow(3, [{key: 'A', value: $('#namaLabel').text()}, {key: 'B', value: $('#namaIsi').val()}]);
                    var r4 = Addrow(4, [{key: 'A', value: $('#alamatLabel').text()}, {key: 'B', value: $('#alamatIsi').val()}]);
                    var r5 = Addrow(5, [{key: 'A', value: $('#umurLabel').text()}, {key: 'B', value: $('#umurIsi').val()}]);
                    var r6 = Addrow(6, [{key: 'A', value: $('#tglLahirLabel').text()}, {key: 'B', value: $('#tglLahirIsi').val()}]);
                    var r7 = Addrow(7, [{key: 'A', value: $('#noTelpLabel').text()}, {key: 'B', value: $('#noTelpIsi').val()}]);

                    sheet.childNodes[0].childNodes[1].innerHTML = r1 + r2 + r3 + r4 + r5 + r6 + r7 + sheet.childNodes[0].childNodes[1].innerHTML;
                }
            },
            {
                extend: 'pdfHtml5',
                text: '<i class="fa fa-file-pdf-o"></i> PDF',
                exportOptions: {
                    columns: [ 1, 2]
                },
                title: 'Riwayat Terapi Pasien',
                filename: 'Riwayat_Terapi_Pasien_' + $('#noRMIsi').val(),
                message: $('#noRMLabel').text() + "\t\t\t\t\t\t\t  " + $('#noRMIsi').val() + "\n" +
                        $('#namaLabel').text() + "\t\t\t\t  " + $('#namaIsi').val() + "\n" +
                        $('#alamatLabel').text() + "\t\t\t\t" + $('#alamatIsi').val() + "\n" +
                        $('#umurLabel').text() + "\t\t\t\t   " + $('#umurIsi').val() + "\n" +
                        $('#tglLahirLabel').text() + "\t" + $('#tglLahirIsi').val() + "\n" +
                        $('#noTelpLabel').text() + "\t\t\t\t\t\t\t" + $('#noTelpIsi').val() + "\n"
            },
            {
                extend: 'print',
                text: '<i class="fa fa-print"></i> Print',
                exportOptions: {
                    columns: [1, 2]
                },
                title: 'Jadwal Terapi Pasien',
                filename: 'Riwayat_Terapi_Pasien_' + $('#noRMIsi').val(),
                message: $('#noRMLabel').text() + "\t\t\t\t\t\t\t  " + $('#noRMIsi').val() + "\n" +
                        $('#namaLabel').text() + "\t\t\t\t  " + $('#namaIsi').val() + "\n"
            }
        ],
        "order": [[1, 'asc']],
        select:{
            style : 'multi'
        }
    });

    //index counter
    t.on('order.dt search.dt', function () {
        t.column(0, {search: 'applied', order: 'applied'}).nodes().each(function (cell, i) {
            cell.innerHTML = i + 1;
            t.cell(cell).invalidate('dom');
        });
    }).draw();


    // Setup - add a text input to each footer cell
    $('.cariKolom').each(function () {
        var title = $(this).text();
        $(this).html('<input type="text" placeholder="Cari ' + title + '" />');
    });

    // DataTable
    var table = $('#test').DataTable();

    // Apply the search
    table.columns().every(function () {
        var that = this;

        $('input', this.footer()).on('keyup change', function () {
            if (that.search() !== this.value) {
                that
                        .search(this.value)
                        .draw();
            }
        });
    });
});